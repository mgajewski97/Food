<!doctype html>
<!-- FIX: Render & responsive boot (2025-08-09) -->
<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Food App</title>
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="apple-touch-icon" href="/static/icons/icon-192x192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Food App" />
    <script>
      window.DEBUG = false;
      (() => {
        const key = "theme";
        const mql = window.matchMedia("(prefers-color-scheme: dark)");
        const apply = (t) => {
          document.documentElement.setAttribute("data-theme", t);
          document.documentElement.style.colorScheme = t;
          const meta = document.querySelector('meta[name="theme-color"]');
          if (meta) {
            const update = () => {
              const color = getComputedStyle(document.documentElement)
                .getPropertyValue("--theme-color")
                .trim();
              if (color) meta.setAttribute("content", color);
            };
            update();
            window.addEventListener("load", update, { once: true });
          }
        };
        const resolve = () => {
          const stored = localStorage.getItem(key) || "system";
          return stored === "system"
            ? mql.matches
              ? "dark"
              : "light"
            : stored;
        };
        apply(resolve());
        if (window.DEBUG) console.info("theme:", resolve());
        mql.addEventListener("change", (e) => {
          if ((localStorage.getItem(key) || "system") === "system") {
            const t = e.matches ? "dark" : "light";
            apply(t);
            if (window.DEBUG) console.info("theme:", t);
          }
        });
        window.setTheme = (v) => {
          localStorage.setItem(key, v);
          const t = v === "system" ? (mql.matches ? "dark" : "light") : v;
          apply(t);
          if (window.DEBUG) console.info("theme:", t);
        };
      })();
    </script>
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@4.10.2/dist/full.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}?v={{ app_version }}"
    />
  </head>
  <body class="min-h-screen bg-base-100">
    <div id="top-sentinel"></div>
    <div id="health-banner" class="alert alert-error hidden justify-between">
      <span data-i18n="error">Error</span>
      <button id="health-retry" class="btn btn-sm" data-i18n="retry" type="button">
        Retry
      </button>
    </div>
    <div
      id="notification-container"
      class="fixed right-4 top-[4.5rem] z-40 flex flex-col items-end gap-2"
    ></div>
    <div
      id="toast-live-region"
      class="sr-only"
      aria-live="polite"
      aria-atomic="true"
    ></div>
    <div id="top-banner-container" class="sticky top-0 z-30"></div>
    <header class="sticky top-0 z-20 grid grid-cols-[auto,1fr,auto] items-center gap-2 px-4 sm:px-6 lg:px-8 py-2 bg-base-100 max-w-screen-xl mx-auto">
      <div class="flex items-center gap-2">
        <span class="font-bold text-lg">Food App</span>
        <span id="locale-chip" class="badge">PL</span>
      </div>
      <div class="overflow-x-auto">
        <div
          class="tabs tabs-bordered flex-nowrap overflow-x-auto whitespace-nowrap desktop-nav"
          role="tablist"
        >
          <a
            class="tab tab-active font-bold"
            role="tab"
            tabindex="0"
            aria-selected="true"
            aria-controls="tab-products" data-tab-target="tab-products"
            data-i18n="tab_products"
            title="Alt+1"
            >Products</a
          >
          <a
            class="tab"
            role="tab"
            tabindex="-1"
            aria-selected="false"
            aria-controls="tab-recipes" data-tab-target="tab-recipes"
            data-i18n="tab_recipes"
            title="Alt+2"
            >Recipes</a
          >
          <a
            class="tab"
            role="tab"
            tabindex="-1"
            aria-selected="false"
            aria-controls="tab-shopping" data-tab-target="tab-shopping"
            data-i18n="tab_shopping"
            title="Alt+3"
            >Shopping</a
          >
          <a
            class="tab"
            role="tab"
            tabindex="-1"
            aria-selected="false"
            aria-controls="tab-history" data-tab-target="tab-history"
            data-i18n="tab_history"
            title="Alt+4"
            >History</a
          >
          <a
            class="tab"
            role="tab"
            tabindex="-1"
            aria-selected="false"
            aria-controls="tab-settings" data-tab-target="tab-settings"
            data-i18n="tab_settings"
            title="Alt+5"
            >Settings</a
          >
        </div>
      </div>
      <div class="flex items-center justify-end gap-2">
        <div id="tab-actions" class="flex items-center gap-2">
          <button
            id="add-product-btn"
            data-action-tab="tab-products"
            class="btn btn-primary btn-sm"
            data-i18n="heading_add_product"
            title="Add product (N)"
            type="button"
            style="display: none"
          >
            Add product
          </button>
          <button
            id="edit-json-header"
            data-action-tab="tab-products"
            class="btn btn-outline btn-sm"
            data-i18n="heading_edit_json"
            type="button"
            style="display: none"
          >
            Bulk edit (JSON)
          </button>
          <button
            id="receipt-btn"
            data-action-tab="tab-shopping"
            class="btn btn-secondary btn-sm"
            data-i18n="receipt_import"
            type="button"
            style="display: none"
          >
            Import receipt
          </button>
        </div>
        <div class="flex items-center gap-2">
          <button
            id="lang-toggle"
            aria-label="Toggle language"
            title="Toggle language"
            class="btn btn-ghost btn-sm"
            type="button"
          >
            <i class="fa-solid fa-language"></i>
            <span class="sr-only" data-i18n="language">Language</span>
          </button>
          <button
            id="theme-toggle"
            aria-label="Toggle theme"
            title="Toggle theme"
            class="btn btn-ghost btn-sm"
            type="button"
          >
            <i id="theme-icon" class="fa-solid fa-desktop"></i>
            <span class="sr-only" data-i18n="theme">Theme</span>
          </button>
          <button
            id="install-btn"
            aria-label="Install app"
            title="Install app"
            class="btn btn-ghost btn-sm"
            style="display: none"
            type="button"
          >
            <i class="fa-solid fa-download"></i>
            <span class="sr-only">Install</span>
          </button>
          <button
            id="settings-btn"
            aria-label="Settings"
            title="Settings"
            class="btn btn-ghost btn-sm"
            type="button"
          >
            <i class="fa-solid fa-gear"></i>
            <span class="sr-only" data-i18n="tab_settings">Settings</span>
          </button>
        </div>
      </div>
    </header>
    <main class="max-w-screen-xl mx-auto p-4 md:p-6 pb-24 main-content">
      <div id="tab-products" class="tab-panel">
        <h1
          class="text-xl md:text-2xl font-semibold mb-4 md:mb-6"
          data-i18n="heading_products"
        >
          Produkty
        </h1>
        <div id="product-filters" class="flex flex-wrap items-center gap-2 mb-2">
          <select id="storage-filter" class="select select-sm select-bordered w-32">
            <option value="">All storages</option>
            <option value="fridge">Fridge</option>
            <option value="freezer">Freezer</option>
            <option value="pantry">Pantry</option>
          </select>
          <select id="status-filter" class="select select-sm select-bordered w-32">
            <option value="">All status</option>
            <option value="available">Available</option>
            <option value="low">Low</option>
            <option value="missing">Missing</option>
          </select>
          <select id="category-filter" class="select select-sm select-bordered w-32">
            <option value="">All categories</option>
          </select>
          <div class="relative">
            <input
              id="product-search-input" placeholder="Search products"
              data-i18n="search_placeholder"
              class="input input-sm input-bordered pr-8 w-64"
              title="Search (/)"
            />
            <button
              id="search-clear"
              class="btn btn-ghost btn-xs absolute right-1 top-1/2 -translate-y-1/2 hidden"
              aria-label="Clear search"
              title="Clear search"
              type="button"
            >
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
        </div>
        <div id="active-filters" class="flex flex-wrap gap-2 mb-4"></div>
        <div id="controls" class="flex flex-wrap items-center gap-4 mb-4">
          <button
            id="view-toggle"
            class="btn btn-outline btn-primary btn-sm min-h-11 justify-center"
            role="switch"
            aria-pressed="false"
            aria-label="Widok z podziałem"
            data-i18n="change_view_toggle_grouped"
            type="button"
          >
            Widok z podziałem
          </button>
          <button
            id="edit-toggle"
            class="btn btn-outline btn-warning btn-sm min-h-11 justify-center"
            role="switch"
            aria-pressed="false"
            aria-label="Tryb edycji"
            data-i18n="edit_mode_button_on"
            type="button"
          >
            Tryb edycji
          </button>
          <button
            id="save-btn"
            style="display: none"
            class="btn btn-primary btn-sm min-h-11 justify-center"
            aria-label="Save"
            data-i18n="save_button"
            type="button"
          >
            Save
          </button>
        </div>
        <div class="overflow-x-auto">
          <div
            id="bulk-actions"
            class="hidden items-center gap-2 p-2 bg-base-200 z-20"
          >
            <span id="bulk-count" class="font-semibold"></span>
            <div class="ml-auto flex gap-2">
              <button
                id="delete-selected"
                class="btn btn-error btn-sm flex items-center gap-1"
                title="Delete selected (Del)"
                disabled
                type="button"
              >
                <i class="fa-solid fa-trash"></i>
                <span data-i18n="delete_selected_button">Delete</span>
              </button>
              <button
                id="move-shopping"
                class="btn btn-primary btn-sm"
                disabled
                type="button"
              >
                Move to Shopping
              </button>
              <button
                id="mark-main"
                class="btn btn-secondary btn-sm"
                disabled
                type="button"
              >
                Mark as Main
              </button>
            </div>
          </div>
          <table
            id="product-table"
            class="table table-zebra table-fixed w-full text-sm"
          >
            <colgroup>
              <col id="select-col" class="w-[6%] hidden" />
              <col class="w-[24%]" />
              <col class="w-[12%]" />
              <col class="w-[12%]" />
              <col class="w-[17%] hidden md:table-column" />
              <col class="w-[17%] hidden md:table-column" />
              <col class="w-[12%]" />
            </colgroup>
            <thead>
              <tr>
                <th id="select-header" class="hidden"></th>
                <th data-sort-by="name" class="sortable">
                  <span data-i18n="table_header_name">Nazwa</span>
                  <i class="fa-solid fa-sort opacity-50"></i>
                </th>
                <th data-i18n="table_header_quantity">Ilość</th>
                <th data-i18n="table_header_unit">Jednostka</th>
                <th class="hidden md:table-cell sortable" data-sort-by="category">
                  <span data-i18n="table_header_category">Kategoria</span>
                  <i class="fa-solid fa-sort opacity-50"></i>
                </th>
                <th class="hidden md:table-cell sortable" data-sort-by="storage">
                  <span data-i18n="table_header_storage">Miejsce</span>
                  <i class="fa-solid fa-sort opacity-50"></i>
                </th>
                <th class="text-center sortable" data-sort-by="status">
                  <span class="tooltip" data-i18n-tip="stock_legend">
                    <i class="fa-solid fa-circle-info"></i>
                  </span>
                  <span class="status-label hidden md:inline" data-i18n="table_header_status">
                    Status
                  </span>
                  <i class="fa-solid fa-sort opacity-50"></i>
                </th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="products-by-category" style="display: none"></div>
        </div>

        <dialog id="delete-modal" class="modal" aria-labelledby="delete-modal-title" role="dialog">
          <form method="dialog" class="modal-box">
            <h3
              id="delete-modal-title"
              class="font-bold text-lg"
              data-i18n="delete_modal_title"
            >
              Potwierdź usunięcie
            </h3>
            <p class="py-4" data-i18n="delete_modal_question">
              Czy na pewno chcesz usunąć zaznaczone produkty?
            </p>
            <div id="delete-summary" class="space-y-1"></div>
            <div class="modal-action justify-between">
              <button
                id="cancel-delete"
                class="btn btn-ghost btn-sm"
                data-i18n="delete_cancel_button"
                aria-label="Cancel"
                type="button"
              >
                Cancel
              </button>
              <button
                id="confirm-delete"
                class="btn btn-error btn-sm flex items-center gap-1"
                data-modal-primary
                type="button"
              >
                <i class="fa-solid fa-trash"></i>
                <span data-i18n="delete_confirm_button">Delete</span>
              </button>
            </div>
          </form>
        </dialog>

        <div id="add-section" style="display: none">
          <hr class="border-t border-base-300 my-6" />

        <h2
          class="text-xl font-semibold mt-6 mb-4"
          data-i18n="heading_add_edit_product"
        >
          Add or edit product
        </h2>
          <form id="add-form" class="space-y-4 mb-6">
            <div class="field-group">
              <div class="flex flex-col flex-1">
                <input
                  name="name"
                  placeholder="nazwa"
                  data-i18n="add_form_name_placeholder"
                  required
                  class="input input-bordered w-full"
                />
                <p class="form-error" data-error-for="name"></p>
              </div>
              <div class="flex flex-col w-24">
                <input
                  name="quantity"
                  placeholder="ilość"
                  data-i18n="add_form_quantity_placeholder"
                  required
                  class="input input-bordered w-full no-spinner"
                  min="0"
                />
                <p class="form-error" data-error-for="quantity"></p>
              </div>
              <div class="flex flex-col w-24">
                <select
                  name="unit"
                  class="select select-bordered w-full"
                  required
                ></select>
                <p class="form-error" data-error-for="unit"></p>
              </div>
            </div>
            <div class="field-group">
              <div class="flex flex-col flex-1">
                <select
                  name="category"
                  required
                  class="select select-bordered w-full"
                >
                  <option
                    value="uncategorized"
                    data-i18n="category_uncategorized"
                  >
                    brak kategorii
                  </option>
                  <option value="fresh_veg" data-i18n="category_fresh_veg">
                    Świeże warzywa
                  </option>
                  <option value="mushrooms" data-i18n="category_mushrooms">
                    Grzyby
                  </option>
                  <option value="dairy_eggs" data-i18n="category_dairy_eggs">
                    Nabiał i jajka
                  </option>
                  <option
                    value="opened_preserves"
                    data-i18n="category_opened_preserves"
                  >
                    Otwarte konserwy i przetwory
                  </option>
                  <option
                    value="ready_sauces"
                    data-i18n="category_ready_sauces"
                  >
                    Sosy
                  </option>
                  <option value="dry_veg" data-i18n="category_dry_veg">
                    Warzywa suche
                  </option>
                  <option value="bread" data-i18n="category_bread">
                    Pieczywo
                  </option>
                  <option value="pasta" data-i18n="category_pasta">
                    Makarony
                  </option>
                  <option value="rice" data-i18n="category_rice">Ryże</option>
                  <option value="grains" data-i18n="category_grains">
                    Kasze
                  </option>
                  <option
                    value="dried_legumes"
                    data-i18n="category_dried_legumes"
                  >
                    Suche rośliny strączkowe
                  </option>
                  <option value="sauces" data-i18n="category_sauces">
                    Sosy i przyprawy płynne
                  </option>
                  <option value="oils" data-i18n="category_oils">Oleje</option>
                  <option value="spreads" data-i18n="category_spreads">
                    Smarowidła i pasty
                  </option>
                  <option value="spices" data-i18n="category_spices">
                    Przyprawy
                  </option>
                  <option value="frozen_veg" data-i18n="category_frozen_veg">
                    Mrożone warzywa
                  </option>
                  <option
                    value="frozen_sauces"
                    data-i18n="category_frozen_sauces"
                  >
                    Mrożone sosy
                  </option>
                  <option
                    value="frozen_meals"
                    data-i18n="category_frozen_meals"
                  >
                    Mrożone dania / zupy
                  </option>
                </select>
                <p class="form-error" data-error-for="category"></p>
              </div>
              <div class="flex flex-col flex-1">
                <select
                  name="storage"
                  required
                  class="select select-bordered w-full"
                >
                  <option value="fridge" data-i18n="storage_fridge">Lodówka</option>
                  <option value="pantry" selected data-i18n="storage_pantry">
                    Szafka
                  </option>
                  <option value="freezer" data-i18n="storage_freezer">
                    Zamrażarka
                  </option>
                </select>
                <p class="form-error" data-error-for="storage"></p>
              </div>
            </div>
            <div class="field-group items-center">
              <div class="flex flex-col w-24">
                <input
                  name="threshold"
                  placeholder="próg"
                  data-i18n="add_form_threshold_placeholder"
                  class="input input-bordered w-full no-spinner"
                  type="number"
                  min="0"
                />
              </div>
              <label class="flex items-center gap-2">
                <input type="checkbox" name="main" class="checkbox" />
                <span data-i18n="checkbox_main_label">Produkt podstawowy</span>
              </label>
            </div>
            <button
              type="submit"
              class="btn btn-primary btn-sm"
              data-i18n="save_button"
              title="Enter – Save\nShift+Enter – Save and add another\nCtrl+Enter – Save\nEsc – Cancel"
            >
              Save
            </button>
          </form>
          <hr class="border-t border-base-300 my-6" />
        </div>

        <h3
          class="text-lg font-semibold mt-6 mb-2"
          data-i18n="heading_edit_json"
        >
          Edytuj produkty (JSON)
        </h3>
        <textarea
          id="edit-json"
          rows="10"
          placeholder="JSON"
          data-i18n="edit_json_placeholder"
          class="textarea textarea-bordered w-full max-w-full mb-4 h-60 overflow-y-auto overflow-x-hidden resize-none p-4"
        ></textarea>
        <div class="flex flex-col sm:flex-row gap-2 mb-8">
          <button
            id="edit-json-btn"
            class="btn btn-outline btn-primary btn-sm w-full sm:w-auto"
            data-i18n="edit_json_submit_button"
            type="button"
          >
            Wyślij JSON
          </button>
          <button
            id="copy-btn"
            class="btn btn-outline btn-sm w-full sm:w-auto"
            data-i18n="copy_structure_button"
            type="button"
          >
            Pobierz strukturę
          </button>
        </div>
      </div>

      <div id="tab-recipes" class="tab-panel" style="display: none">
        <h1
          class="text-xl md:text-2xl font-semibold mb-3 md:mb-4"
          data-i18n="heading_recipes"
        >
          Przepisy
        </h1>
        <div id="recipe-layout" class="md:grid md:grid-cols-2 md:gap-4">
          <div class="flex flex-col md:h-[60vh]">
            <div
              id="recipe-controls"
              class="flex flex-col sm:flex-row flex-wrap gap-4 mb-4"
            >
          <div
            class="flex flex-col sm:flex-row items-start sm:items-center gap-2"
          >
            <span data-i18n="recipe_sort_label">Sortuj według:</span>
            <div
              id="recipe-sort-desktop-container"
              class="flex items-center gap-2"
            >
              <select
                id="recipe-sort-field"
                class="select select-bordered select-sm w-full sm:w-auto"
              >
                <option value="name" data-i18n="recipe_sort_name">Nazwy</option>
                <option value="time" data-i18n="recipe_sort_time">Czasu</option>
                <option value="portions" data-i18n="recipe_sort_portions">
                  Porcji
                </option>
              </select>
              <div class="join">
                <button
                  id="recipe-sort-dir-asc"
                  type="button"
                  class="btn btn-sm join-item"
                  data-i18n="recipe_sort_dir_asc"
                >
                  Rosnąco
                </button>
                <button
                  id="recipe-sort-dir-desc"
                  type="button"
                  class="btn btn-sm join-item"
                  data-i18n="recipe_sort_dir_desc"
                >
                  Malejąco
                </button>
              </div>
            </div>
          </div>
          <div
            class="flex flex-col sm:flex-row items-start sm:items-center gap-2"
          >
            <label for="recipe-time-filter" data-i18n="recipe_filter_time_label"
              >Czas:</label
            >
            <select
              id="recipe-time-filter"
              class="select select-bordered w-full sm:w-auto"
            >
              <option value="" data-i18n="filter_all">Wszystkie</option>
              <option value="lt30" data-i18n="recipe_filter_time_lt30">
                &lt;30min
              </option>
              <option value="30-60" data-i18n="recipe_filter_time_30_60">
                30–60min
              </option>
              <option value="gt60" data-i18n="recipe_filter_time_gt60">
                &gt;60min
              </option>
            </select>
          </div>
          <div
            class="flex flex-col sm:flex-row items-start sm:items-center gap-2"
          >
            <label
              for="recipe-portions-filter"
              data-i18n="recipe_filter_portions_label"
              >Porcje</label
            >
            <select
              id="recipe-portions-filter"
              class="select select-bordered w-full sm:w-auto"
            >
              <option value="" data-i18n="filter_all">Wszystkie</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5+">5+</option>
            </select>
          </div>
        <button
          id="recipe-favorites-toggle"
          class="btn btn-outline btn-sm self-start"
          data-i18n="recipe_filter_favorites"
          type="button"
        >
          Ulubione przepisy
        </button>
            <button
              id="recipe-clear-filters"
              class="btn btn-outline btn-sm self-start"
              data-i18n="recipe_clear_filters"
              type="button"
            >
              Wyczyść filtry
            </button>
          </div>
          <div
            id="recipe-list"
            role="list"
            aria-live="polite"
            class="flex-1 overflow-y-auto mb-4"
          ></div>
        </div>
        <div id="recipe-detail" class="hidden md:block md:h-[60vh] overflow-y-auto"></div>
        </div>
      </div>

      <div id="tab-history" class="tab-panel" style="display: none">
        <h1
          class="text-xl md:text-2xl font-semibold mb-3 md:mb-4"
          data-i18n="heading_history"
        >
          History
        </h1>
        <ul id="history-list" class="list-disc pl-4"></ul>

        <dialog
          id="rating-modal"
          class="modal"
          aria-labelledby="rating-title"
          role="dialog"
        >
          <form method="dialog" id="rating-form" class="modal-box">
            <h3 id="rating-title" class="font-bold text-lg"></h3>
            <div class="py-4 space-y-4">
              <div>
                <span data-i18n="label_taste" class="block mb-2">Smak:</span>
                <div class="rating flex gap-1 text-2xl" data-name="taste">
                  <i
                    class="fa-regular fa-star star cursor-pointer text-base-300"
                  ></i>
                  <i
                    class="fa-regular fa-star star cursor-pointer text-base-300"
                  ></i>
                  <i
                    class="fa-regular fa-star star cursor-pointer text-base-300"
                  ></i>
                  <i
                    class="fa-regular fa-star star cursor-pointer text-base-300"
                  ></i>
                  <i
                    class="fa-regular fa-star star cursor-pointer text-base-300"
                  ></i>
                </div>
              </div>
              <div>
                <span data-i18n="label_prep_time" class="block mb-2"
                  >Czas przygotowania:</span
                >
                <div class="rating flex gap-1 text-2xl" data-name="time">
                  <i
                    class="fa-regular fa-star star cursor-pointer text-base-300"
                  ></i>
                  <i
                    class="fa-regular fa-star star cursor-pointer text-base-300"
                  ></i>
                  <i
                    class="fa-regular fa-star star cursor-pointer text-base-300"
                  ></i>
                  <i
                    class="fa-regular fa-star star cursor-pointer text-base-300"
                  ></i>
                  <i
                    class="fa-regular fa-star star cursor-pointer text-base-300"
                  ></i>
                </div>
              </div>
              <div>
                <textarea
                  name="comment"
                  placeholder="Komentarz"
                  data-i18n="comment_placeholder"
                  class="textarea textarea-bordered w-full overflow-y-auto"
                ></textarea>
              </div>
            </div>
            <div class="modal-action justify-between">
              <button
                type="button"
                id="rating-cancel"
                class="btn btn-ghost btn-sm"
                data-i18n="delete_cancel_button"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="btn btn-primary btn-sm"
                data-modal-primary
                data-i18n="save_button"
              >
                Save
              </button>
            </div>
          </form>
        </dialog>

        <dialog
          id="history-detail-modal"
          class="modal"
          aria-labelledby="history-detail-title"
          role="dialog"
        >
          <div class="modal-box max-w-lg">
            <h3 id="history-detail-title" class="font-bold text-lg mb-4"></h3>
            <div class="space-y-4">
              <div id="history-detail-ingredients-wrap">
                <h4
                  class="font-semibold mb-2"
                  data-i18n="recipe_ingredients_header"
                >
                  Składniki
                </h4>
                <ul id="history-detail-ingredients" class="list-disc pl-4"></ul>
              </div>
              <div id="history-detail-rating-wrap" class="space-y-1">
                <div>
                  <span data-i18n="label_taste">Smak:</span>
                  <span id="history-detail-taste"></span>
                </div>
                <div>
                  <span data-i18n="label_prep_time">Czas przygotowania:</span>
                  <span id="history-detail-prep"></span>
                </div>
              </div>
              <div id="history-detail-comment-wrap">
                <h4 class="font-semibold mb-2">
                  <span data-i18n="comment_placeholder">Komentarz</span>:
                </h4>
                <p id="history-detail-comment"></p>
              </div>
            </div>
            <div class="modal-action">
              <button
                id="history-detail-close"
                class="btn btn-sm"
                data-i18n="close"
                aria-label="Zamknij"
                type="button"
              >
                Zamknij
              </button>
            </div>
          </div>
        </dialog>

        <div
          id="cooking-overlay"
          class="fixed inset-0 bg-base-100 z-50 hidden flex flex-col items-center justify-center p-4"
        >
          <div id="cooking-step" class="text-xl text-center mb-6"></div>
          <button
            id="cooking-next"
            class="btn btn-primary mb-4"
            data-i18n="next_step_button"
            type="button"
          >
            Dalej
          </button>
          <form id="cooking-form" class="w-full max-w-md space-y-4 hidden">
            <textarea
              name="comment"
              placeholder="Komentarz"
              data-i18n="comment_placeholder"
              class="textarea textarea-bordered w-full overflow-y-auto"
            ></textarea>
            <div>
              <span data-i18n="label_taste" class="block mb-2">Smak:</span>
              <div class="rating flex gap-1 text-2xl" data-name="taste">
                <i
                  class="fa-regular fa-star star cursor-pointer text-base-300"
                ></i>
                <i
                  class="fa-regular fa-star star cursor-pointer text-base-300"
                ></i>
                <i
                  class="fa-regular fa-star star cursor-pointer text-base-300"
                ></i>
                <i
                  class="fa-regular fa-star star cursor-pointer text-base-300"
                ></i>
                <i
                  class="fa-regular fa-star star cursor-pointer text-base-300"
                ></i>
              </div>
            </div>
            <div>
              <span data-i18n="label_prep_time" class="block mb-2"
                >Czas przygotowania:</span
              >
              <div class="rating flex gap-1 text-2xl" data-name="time">
                <i
                  class="fa-regular fa-star star cursor-pointer text-base-300"
                ></i>
                <i
                  class="fa-regular fa-star star cursor-pointer text-base-300"
                ></i>
                <i
                  class="fa-regular fa-star star cursor-pointer text-base-300"
                ></i>
                <i
                  class="fa-regular fa-star star cursor-pointer text-base-300"
                ></i>
                <i
                  class="fa-regular fa-star star cursor-pointer text-base-300"
                ></i>
              </div>
            </div>
            <button
              type="submit"
              class="btn btn-primary"
              data-i18n="save_button"
            >
              Save
            </button>
          </form>
        </div>
      </div>

      <div id="tab-shopping" class="tab-panel" style="display: none">
        <h1 class="text-2xl font-bold mb-6" data-i18n="heading_shopping">
          Shopping
        </h1>
        <input id="receipt-input" type="file" accept="image/*" class="hidden" />
        <dialog id="receipt-sheet" class="modal modal-bottom sm:modal-middle" role="dialog">
          <form method="dialog" class="modal-box">
            <button
              id="receipt-camera"
              class="btn w-full mb-2"
              data-i18n="camera"
              type="button"
            >
              Aparat
            </button>
            <button
              id="receipt-upload"
              class="btn w-full"
              data-i18n="choose_file"
              type="button"
            >
              Wybierz plik
            </button>
          </form>
        </dialog>
        <dialog id="receipt-upload-modal" class="modal" role="dialog">
          <form method="dialog" class="modal-box">
            <div
              id="receipt-drop-area"
              class="border-2 border-dashed rounded p-8 text-center"
            >
              <button id="receipt-choose" class="btn" data-i18n="choose_file" type="button">
                Wybierz plik
              </button>
            </div>
          </form>
        </dialog>
        <div id="suggestions-section" class="mb-8">
          <h2
            class="text-xl font-semibold mb-4"
            data-i18n="heading_suggestions"
          >
            Propozycje
          </h2>
          <div
            id="suggestion-list"
            class="border border-base-300 rounded-lg divide-y divide-base-300"
          ></div>
        </div>
        <div id="shopping-list-section" class="mb-8">
          <h2
            class="text-xl font-semibold mb-4"
            data-i18n="heading_shopping_list"
          >
            Shopping list
          </h2>
          <div
            id="shopping-summary"
            class="flex items-center justify-between mb-4"
          >
            <div>
              <span id="shopping-total">0</span> items,
              <span id="shopping-purchased">0</span> purchased
            </div>
            <div class="flex gap-2">
              <button
                id="add-missing-recipes"
                class="btn btn-sm"
                type="button"
              >
                Add missing products from recipes
              </button>
              <button
                id="clear-purchased"
                class="btn btn-sm btn-error"
                type="button"
                disabled
              >
                Clear purchased
              </button>
            </div>
          </div>
          <div
            id="shopping-list"
            class="border border-base-300 rounded-lg"
          ></div>
        </div>
        <hr class="border-t border-base-300 mt-6 mb-4" />
        <div
          id="manual-add-section"
          class="mb-8 p-4 shadow rounded bg-base-100"
        >
          <h2 class="text-xl font-bold mb-4" data-i18n="heading_add_product">
            Add product
          </h2>
          <div class="flex flex-wrap items-center gap-2">
            <input
              id="manual-name"
              list="product-datalist"
              class="input input-bordered flex-1"
              placeholder="nazwa"
              data-i18n="add_form_name_placeholder"
            />
            <div class="flex items-center gap-2">
              <button
                id="manual-dec"
                type="button"
                class="text-xl touch-btn"
                aria-label="Decrease quantity"
                title="Decrease quantity"
              >
                <i class="fa-solid fa-minus"></i>
              </button>
              <span
                id="manual-qty"
                class="w-10 h-10 inline-flex items-center justify-center text-center mx-2"
                >1</span
              >
              <button
                id="manual-inc"
                type="button"
                class="text-xl touch-btn"
                aria-label="Increase quantity"
                title="Increase quantity"
              >
                <i class="fa-solid fa-plus"></i>
              </button>
            </div>
            <button
              id="manual-add-btn"
              class="btn btn-primary btn-sm"
              data-i18n="save_button"
              type="button"
            >
              Save
            </button>
          </div>
          <datalist id="product-datalist"></datalist>
        </div>
        <dialog
          id="receipt-modal"
          class="modal"
          aria-labelledby="receipt-modal-title"
          role="dialog"
        >
          <form method="dialog" class="modal-box w-11/12 max-w-3xl">
            <h3
              id="receipt-modal-title"
              class="font-bold text-lg"
              data-i18n="receipt_import"
            >
              Import receipt
            </h3>
            <div class="overflow-x-auto">
              <table id="receipt-table" class="table w-full">
                <thead>
                  <tr>
                    <th data-i18n="table_header_name">Nazwa</th>
                    <th data-i18n="table_header_quantity">Ilość</th>
                    <th></th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="modal-action justify-between">
              <button class="btn btn-ghost" data-i18n="delete_cancel_button" type="button">
                Cancel
              </button>
              <button
                id="receipt-confirm"
                class="btn btn-primary"
                data-modal-primary
                data-i18n="confirm_import"
                type="button"
              >
                Zatwierdź import
              </button>
            </div>
          </form>
        </dialog>
        <dialog
          id="shopping-delete-modal"
          class="modal"
          aria-labelledby="shopping-delete-title"
          role="dialog"
        >
          <form method="dialog" class="modal-box">
            <h3
              id="shopping-delete-title"
              class="font-bold text-lg"
              data-i18n="delete_modal_title"
            >
              Potwierdź usunięcie
            </h3>
            <p class="py-4" data-i18n="delete_item_question">
              Czy na pewno chcesz usunąć ten produkt?
            </p>
            <div class="modal-action justify-between">
              <button
                class="btn btn-ghost btn-sm"
                data-i18n="delete_cancel_button"
                aria-label="Cancel"
                type="button"
              >
                Cancel
              </button>
              <button
                id="confirm-remove-item"
                class="btn btn-error btn-sm flex items-center gap-1"
                data-modal-primary
                type="button"
              >
                <i class="fa-solid fa-trash"></i>
                <span data-i18n="delete_confirm_button">Delete</span>
              </button>
            </div>
          </form>
        </dialog>
        <dialog id="shopping-clear-modal" class="modal" role="dialog">
          <form method="dialog" class="modal-box">
            <h3 class="font-bold text-lg mb-4">Clear purchased?</h3>
            <p>Remove all purchased items?</p>
            <div class="modal-action justify-between">
              <button class="btn btn-ghost btn-sm" type="button">
                Cancel
              </button>
              <button
                id="confirm-clear-purchased"
                class="btn btn-error btn-sm"
                data-modal-primary
                type="button"
              >
                Confirm
              </button>
            </div>
          </form>
        </dialog>
      </div>

      <div id="tab-settings" class="tab-panel" style="display: none">
        <h1
          class="text-xl md:text-2xl font-semibold mb-3 md:mb-4"
          data-i18n="heading_settings"
        >
          Settings
        </h1>
        <h2
          class="text-xl font-semibold mb-4"
          data-i18n="settings_units_header"
        >
          Units
        </h2>
        <div class="overflow-x-auto">
          <table id="units-table" class="table table-zebra w-full">
            <colgroup>
              <col class="w-1/3" />
              <col class="w-1/3" />
              <col class="w-1/3" />
            </colgroup>
            <thead>
              <tr class="text-center">
                <th class="w-1/3" data-i18n="settings_unit_code">Kod</th>
                <th class="w-1/3" data-i18n="settings_unit_pl">Polski</th>
                <th class="w-1/3" data-i18n="settings_unit_en">Angielski</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <button
          id="units-save"
          class="btn btn-primary btn-sm mt-4"
          data-i18n="save_button"
          type="button"
        >
          Save
        </button>
      </div>
    </main>

    <script>
      window.APP_VERSION = {{ app_version|tojson }};
    </script>
    <script type="module" src="/static/script.js?v={{ app_version }}"></script>
  </body>
</html>
